import os
import csv
import glob
from operator import itemgetter

# Каталог із твоїми файлами
КАТАЛОГ_ДАНИХ = "групи_студентів"

def прочитати_файл_групи(назва_групи):
    """Читає та виводить вміст файлу групи."""
    ім_я_файлу = os.path.join(КАТАЛОГ_ДАНИХ, f"{назва_групи}.txt")
    if not os.path.exists(ім_я_файлу):
        print(f"Файл для групи {назва_групи} не знайдено")
        return []
    
    студенти = []
    with open(ім_я_файлу, 'r', encoding='utf-8') as файл:
        читач = csv.reader(файл, delimiter='\t')
        next(читач)  # Пропустити заголовок
        for рядок in читач:
            студенти.append((рядок[0], float(рядок[1])))
            print(f"Студент: {рядок[0]}, Бал: {рядок[1]}")
    return студенти

def додати_до_групи(назва_групи, ім_я_студента, бал):
    """Додає нового студента до файлу групи."""
    ім_я_файлу = os.path.join(КАТАЛОГ_ДАНИХ, f"{назва_групи}.txt")
    if not os.path.exists(ім_я_файлу):
        print(f"Файл для групи {назва_групи} не знайдено")
        return
    with open(ім_я_файлу, 'a', encoding='utf-8') as файл:
        записувач = csv.writer(файл, delimiter='\t', lineterminator='\n')
        записувач.writerow([ім_я_студента, f"{бал:.1f}"])
    print(f"Додано {ім_я_студента} до групи {назва_групи}")

def перелічити_файли_груп():
    """Виводить список усіх файлів груп у каталозі."""
    шаблон = os.path.join(КАТАЛОГ_ДАНИХ, "*.txt")
    файли_груп = glob.glob(шаблон)
    print("Доступні файли груп:")
    for файл in файли_груп:
        print(os.path.basename(файл))
    return файли_груп

def знайти_студента(назва_групи, ім_я_студента):
    """Шукає студента у файлі групи."""
    ім_я_файлу = os.path.join(КАТАЛОГ_ДАНИХ, f"{назва_групи}.txt")
    if not os.path.exists(ім_я_файлу):
        print(f"Файл для групи {назва_групи} не знайдено")
        return None
    
    with open(ім_я_файлу, 'r', encoding='utf-8') as файл:
        читач = csv.reader(файл, delimiter='\t')
        next(читач)  # Пропустити заголовок
        for рядок in читач:
            if рядок[0].lower() == ім_я_студента.lower():
                print(f"Знайдено: {рядок[0]}, Бал: {рядок[1]}")
                return (рядок[0], float(рядок[1]))
    print(f"Студента {ім_я_студента} не знайдено в групі {назва_групи}")
    return None

def сортувати_групу_за_балом(назва_групи):
    """Сортує студентів у файлі групи за середнім балом."""
    ім_я_файлу = os.path.join(КАТАЛОГ_ДАНИХ, f"{назва_групи}.txt")
    if not os.path.exists(ім_я_файлу):
        print(f"Файл для групи {назва_групи} не знайдено")
        return
    
    # Читання всіх студентів
    студенти = []
    with open(ім_я_файлу, 'r', encoding='utf-8') as файл:
        читач = csv.reader(файл, delimiter='\t')
        next(читач)  # Пропустити заголовок
        студенти = [(рядок[0], float(рядок[1])) for рядок in читач]
    
    # Сортування за балом (спадання)
    студенти.sort(key=itemgetter(1), reverse=True)
    
    # Перезапис файлу з відсортованими даними
    with open(ім_я_файлу, 'w', encoding='utf-8') as файл:
        записувач = csv.writer(файл, delimiter='\t', lineterminator='\n')
        записувач.writerow(['Ім_я', 'Середній_бал'])
        for ім_я, бал in студенти:
            записувач.writerow([ім_я, f"{бал:.1f}"])
    print(f"Відсортовано групу {назва_групи} за балами")

# Приклад використання з існуючими файлами
if __name__ == "__main__":
    # Переглянути доступні групи
    print("Список груп:")
    перелічити_файли_груп()
    
    # Читати дані з файлу Група1
    print("\nЧитання ГрупиКБ:")
    прочитати_файл_групи("ГрупаКБ")
    
    # Додати нового студента до Група1
    print("\nДодавання нового студента до ГрупиКБ:")
    додати_до_групи("ГрупаКБ", "Марія Коваль", 87.0)
    
    # Знайти студента в Групі1
    print("\nПошук студента в ГрупіКБ:")
    знайти_студента("ГрупаКБ", "Томаш Вільсон")
    
    # Відсортувати Група1 за балами
    print("\nСортування ГрупиКБ за балами:")
    сортувати_групу_за_балом("ГрупаКБ")
    
    # Прочитати відсортовану Групу1
    print("\nЧитання відсортованої ГрупиКБ:")
    прочитати_файл_групи("ГрупаКБ")
    