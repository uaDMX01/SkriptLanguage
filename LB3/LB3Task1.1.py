import os
import csv
import glob
from operator import itemgetter

# Каталог для файлів груп
КАТАЛОГ_ДАНИХ = "групи_студентів"
os.makedirs(КАТАЛОГ_ДАНИХ, exist_ok=True)

def створити_файл_групи(назва_групи, студенти):
    """Створює файл для групи зі списком студентів та їхніми балами."""
    ім_я_файлу = os.path.join(КАТАЛОГ_ДАНИХ, f"{назва_групи}.txt")
    with open(ім_я_файлу, 'w', encoding='utf-8') as файл:
        записувач = csv.writer(файл, delimiter='\t', lineterminator='\n')
        записувач.writerow(['Ім_я', 'Середній_бал'])
        for ім_я, бал in студенти:
            записувач.writerow([ім_я, f"{бал:.1f}"])
    print(f"Створено файл для групи {назва_групи}")

def прочитати_файл_групи(назва_групи):
    """Читає та виводить вміст файлу групи."""
    ім_я_файлу = os.path.join(КАТАЛОГ_ДАНИХ, f"{назва_групи}.txt")
    if not os.path.exists(ім_я_файлу):
        print(f"Файл для групи {назва_групи} не знайдено")
        return []
    
    студенти = []
    with open(ім_я_файлу, 'r', encoding='utf-8') as файл:
        читач = csv.reader(файл, delimiter='\t')
        next(читач)  # Пропустити заголовок
        for рядок in читач:
            студенти.append((рядок[0], float(рядок[1])))
            print(f"Студент: {рядок[0]}, Бал: {рядок[1]}")
    return студенти

def додати_до_групи(назва_групи, ім_я_студента, бал):
    """Додає нового студента до файлу групи."""
    ім_я_файлу = os.path.join(КАТАЛОГ_ДАНИХ, f"{назва_групи}.txt")
    with open(ім_я_файлу, 'a', encoding='utf-8') as файл:
        записувач = csv.writer(файл, delimiter='\t', lineterminator='\n')
        записувач.writerow([ім_я_студента, f"{бал:.1f}"])
    print(f"Додано {ім_я_студента} до групи {назва_групи}")

def перелічити_файли_груп():
    """Виводить список усіх файлів груп у каталозі."""
    шаблон = os.path.join(КАТАЛОГ_ДАНИХ, "*.txt")
    файли_груп = glob.glob(шаблон)
    print("Доступні файли груп:")
    for файл in файли_груп:
        print(os.path.basename(файл))
    return файли_груп

def знайти_студента(назва_групи, ім_я_студента):
    """Шукає студента у файлі групи."""
    ім_я_файлу = os.path.join(КАТАЛОГ_ДАНИХ, f"{назва_групи}.txt")
    if not os.path.exists(ім_я_файлу):
        print(f"Файл для групи {назва_групи} не знайдено")
        return None
    
    with open(ім_я_файлу, 'r', encoding='utf-8') as файл:
        читач = csv.reader(файл, delimiter='\t')
        next(читач)  # Пропустити заголовок
        for рядок in читач:
            if рядок[0].lower() == ім_я_студента.lower():
                print(f"Знайдено: {рядок[0]}, Бал: {рядок[1]}")
                return (рядок[0], float(рядок[1]))
    print(f"Студента {ім_я_студента} не знайдено в групі {назва_групи}")
    return None

def сортувати_групу_за_балом(назва_групи):
    """Сортує студентів у файлі групи за середнім балом."""
    ім_я_файлу = os.path.join(КАТАЛОГ_ДАНИХ, f"{назва_групи}.txt")
    if not os.path.exists(ім_я_файлу):
        print(f"Файл для групи {назва_групи} не знайдено")
        return
    
    # Читання всіх студентів
    студенти = []
    with open(ім_я_файлу, 'r', encoding='utf-8') as файл:
        читач = csv.reader(файл, delimiter='\t')
        next(читач)  # Пропустити заголовок
        студенти = [(рядок[0], float(рядок[1])) for рядок in читач]
    
    # Сортування за балом (спадання)
    студенти.sort(key=itemgetter(1), reverse=True)
    
    # Перезапис файлу з відсортованими даними
    with open(ім_я_файлу, 'w', encoding='utf-8') as файл:
        записувач = csv.writer(файл, delimiter='\t', lineterminator='\n')
        записувач.writerow(['Ім_я', 'Середній_бал'])
        for ім_я, бал in студенти:
            записувач.writerow([ім_я, f"{бал:.1f}"])
    print(f"Відсортовано групу {назва_групи} за балами")

# Приклад використання
if __name__ == "__main__":
    # Створення зразків файлів груп
    студенти_групи1 = [
        ("Іван Петренко", 85.5),
        ("Олена Сидоренко", 92.0),
        ("Петро Іванов", 78.5)
    ]
    
    студенти_групи2 = [
        ("Аліна Коваленко", 88.0),
        ("Томаш Вільсон", 95.5),
        ("Емма Давиденко", 82.0)
    ]
    
    створити_файл_групи("Група1", студенти_групи1)
    створити_файл_групи("Група2", студенти_групи2)
    
    print("\nЧитання Групи1:")
    прочитати_файл_групи("Група1")
    
    print("\nДодавання нового студента до Групи1:")
    додати_до_групи("Група1", "Сара Мельник", 90.0)
    
    print("\nСписок усіх файлів груп:")
    перелічити_файли_груп()
    
    print("\nПошук студента в Групі1:")
    знайти_студента("Група1", "Олена Сидоренко")
    
    print("\nСортування Групи1 за балами:")
    сортувати_групу_за_балом("Група1")
    
    print("\nЧитання відсортованої Групи1:")
    прочитати_файл_групи("Група1")