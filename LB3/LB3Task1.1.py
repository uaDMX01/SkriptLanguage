import os
import csv
import glob
from operator import itemgetter

# Каталог для файлів груп
КАТАЛОГ_ДАНИХ = "групи_студентів"
os.makedirs(КАТАЛОГ_ДАНИХ, exist_ok=True)

def створити_файл_групи(назва_групи, студенти):
    """Створює файл для групи зі списком студентів та їхніми балами."""
    ім_я_файлу = os.path.join(КАТАЛОГ_ДАНИХ, f"{назва_групи}.txt")
    with open(ім_я_файлу, 'w', encoding='utf-8') as файл:
        записувач = csv.writer(файл, delimiter='\t', lineterminator='\n')
        записувач.writerow(['Ім_я', 'Середній_бал'])
        for ім_я, бал in студенти:
            записувач.writerow([ім_я, f"{бал:.1f}"])
    print(f"Створено файл для групи {назва_групи}")

def прочитати_файл_групи(назва_групи):
    """Читає та виводить вміст файлу групи."""
    ім_я_файлу = os.path.join(КАТАЛОГ_ДАНИХ, f"{назва_групи}.txt")
    if not os.path.exists(ім_я_файлу):
        print(f"Файл для групи {назва_групи} не знайдено")
        return []
    
    студенти = []
    with open(ім_я_файлу, 'r', encoding='utf-8') as файл:
        читач = csv.reader(файл, delimiter='\t')
        next(читач)  # Пропустити заголовок
        for рядок in читач:
            студенти.append((рядок[0], float(рядок[1])))
            print(f"Студент: {рядок[0]}, Бал: {рядок[1]}")
    return студенти

def додати_до_групи(назва_групи, ім_я_студента, бал):
    """Додає нового студента до файлу групи."""
    ім_я_файлу = os.path.join(КАТАЛОГ_ДАНИХ, f"{назва_групи}.txt")
    with open(ім_я_файлу, 'a', encoding='utf-8') as файл:
        записувач = csv.writer(файл, delimiter='\t', lineterminator='\n')
        записувач.writerow([ім_я_студента, f"{бал:.1f}"])
    print(f"Додано {ім_я_студента} до групи {назва_групи}")

def перелічити_файли_груп():
    """Виводить список усіх файлів груп у каталозі."""
    шаблон = os.path.join(КАТАЛОГ_ДАНИХ, "*.txt")
    файли_груп = glob.glob(шаблон)
    print("Доступні файли груп:")
    for файл in файли_груп:
        print(os.path.basename(файл))
    return файли_груп

def знайти_студента(назва_групи, ім_я_студента):
    """Шукає всіх студентів із заданим ім’ям у файлі групи."""
    ім_я_файлу = os.path.join(КАТАЛОГ_ДАНИХ, f"{назва_групи}.txt")
    if not os.path.exists(ім_я_файлу):
        print(f"Файл для групи {назва_групи} не знайдено")
        return []
    
    знайдені_студенти = []
    with open(ім_я_файлу, 'r', encoding='utf-8') as файл:
        читач = csv.reader(файл, delimiter='\t')
        next(читач)  # Пропустити заголовок
        for рядок in читач:
            if рядок[0].lower() == ім_я_студента.lower():
                print(f"Знайдено: {рядок[0]}, Бал: {рядок[1]}")
                знайдені_студенти.append((рядок[0], float(рядок[1])))
    
    if not знайдені_студенти:
        print(f"Студента {ім_я_студента} не знайдено в групі {назва_групи}")
        return []
    return знайдені_студенти

def сортувати_групу_за_балом(назва_групи):
    """Сортує студентів у файлі групи за середнім балом."""
    ім_я_файлу = os.path.join(КАТАЛОГ_ДАНИХ, f"{назва_групи}.txt")
    if not os.path.exists(ім_я_файлу):
        print(f"Файл для групи {назва_групи} не знайдено")
        return
    
    # Читання всіх студентів
    студенти = []
    with open(ім_я_файлу, 'r', encoding='utf-8') as файл:
        читач = csv.reader(файл, delimiter='\t')
        next(читач)  # Пропустити заголовок
        студенти = [(рядок[0], float(рядок[1])) for рядок in читач]
    
    # Сортування за балом (спадання)
    студенти.sort(key=itemgetter(1), reverse=True)
    
    # Перезапис файлу з відсортованими даними
    with open(ім_я_файлу, 'w', encoding='utf-8') as файл:
        записувач = csv.writer(файл, delimiter='\t', lineterminator='\n')
        записувач.writerow(['Ім_я', 'Середній_бал'])
        for ім_я, бал in студенти:
            записувач.writerow([ім_я, f"{бал:.1f}"])
    print(f"Відсортовано групу {назва_групи} за балами")

# Приклад використання для двох груп
if __name__ == "__main__":
    # Створюємо початкові файли для Група1 і Група2
    студенти_групи1 = [
        ("Олена Сидоренко", 92.0),
        ("Петро Іванов", 78.5)
    ]
    студенти_групи2 = [
        ("Аліна Коваленко", 88.0),
        ("Томаш Вільсон", 95.5),
        ("Емма Давиденко", 82.0)
    ]
    створити_файл_групи("Група1", студенти_групи1)
    створити_файл_групи("Група2", студенти_групи2)
    
    # Додаємо трьох студентів з однаковим ім’ям до Група1
    print("\nДодавання трьох студентів з ім’ям 'Іван Петренко' до Групи1:")
    додати_до_групи("Група1", "Іван Петренко", 85.5)
    додати_до_групи("Група1", "Іван Петренко", 90.0)
    додати_до_групи("Група1", "Іван Петренко", 87.0)
    
    # Додаємо трьох студентів з однаковим ім’ям до Група2
    print("\nДодавання трьох студентів з ім’ям 'Марія Коваль' до Групи2:")
    додати_до_групи("Група2", "Марія Коваль", 89.0)
    додати_до_групи("Група2", "Марія Коваль", 84.5)
    додати_до_групи("Група2", "Марія Коваль", 91.0)
    
    # Переглядаємо вміст обох груп
    print("\nВміст Групи1 після додавання:")
    прочитати_файл_групи("Група1")
    
    print("\nВміст Групи2 після додавання:")
    прочитати_файл_групи("Група2")
    
    # Перелічуємо файли груп
    print("\nСписок усіх файлів груп:")
    перелічити_файли_груп()
    
    # Шукаємо всіх студентів з ім’ям 'Іван Петренко' у Групі1
    print("\nПошук студента 'Іван Петренко' у Групі1:")
    знайти_студента("Група1", "Іван Петренко")
    
    # Шукаємо всіх студентів з ім’ям 'Марія Коваль' у Групі2
    print("\nПошук студента 'Марія Коваль' у Групі2:")
    знайти_студента("Група2", "Марія Коваль")
    
    # Сортуємо обидві групи за балами
    print("\nСортування Групи1 за балами:")
    сортувати_групу_за_балом("Група1")
    
    print("\nСортування Групи2 за балами:")
    сортувати_групу_за_балом("Група2")
    
    # Переглядаємо відсортовані файли
    print("\nВміст відсортованої Групи1:")
    прочитати_файл_групи("Група1")
    
    print("\nВміст відсортованої Групи2:")
    прочитати_файл_групи("Група2")